<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de An√°lise de Cr√©dito - Completo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        h2 { text-align: center; color: #1a1a1a; margin-bottom: 20px; }
        
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9em; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; transition: border 0.3s; }
        input:focus, select:focus { border-color: #007bff; outline: none; }
        
        button { width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 20px; transition: background 0.3s; }
        button:hover { background-color: #0056b3; }
        
        #resultado { margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; display: none; animation: fadeIn 0.5s; }
        .aprovado { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .reprovado { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
        
        .score-badge { font-size: 2em; font-weight: bold; display: block; margin: 10px 0; }
        .loading { text-align: center; color: #666; font-style: italic; display: none; margin-top: 10px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="card">
        <h2>üè¶ An√°lise de Risco Completa</h2>
        
        <div class="form-grid">
            <div class="full-width">
                <label>Nome Completo</label>
                <input type="text" id="nome" placeholder="Ex: Jo√£o Silva">
            </div>
            
            <div>
                <label>CPF</label>
                <input type="text" id="cpf" placeholder="000.000.000-00">
            </div>
            <div>
                <label>Idade</label>
                <input type="number" id="idade" placeholder="Ex: 30">
            </div>

            <div>
                <label>Renda Mensal (R$)</label>
                <input type="number" id="renda" placeholder="Ex: 5000">
            </div>
            <div>
                <label>Tempo de Emprego (Anos)</label>
                <input type="number" id="tempoEmprego" step="0.1" placeholder="Ex: 2.5">
            </div>

            <div>
                <label>Valor Solicitado (R$)</label>
                <input type="number" id="valor" placeholder="Ex: 20000">
            </div>
            <div>
                <label>Parcelas</label>
                <input type="number" id="parcelas" placeholder="Ex: 24">
            </div>

            <div class="full-width">
                <label>Finalidade do Empr√©stimo</label>
                <select id="finalidade">
                    <option value="PERSONAL">Uso Pessoal</option>
                    <option value="EDUCATION">Educa√ß√£o / Estudos</option>
                    <option value="MEDICAL">Sa√∫de / M√©dico</option>
                    <option value="VENTURE">Empreendimento / Neg√≥cio</option>
                    <option value="HOMEIMPROVEMENT">Reforma da Casa</option>
                    <option value="DEBTCONSOLIDATION">Pagar D√≠vidas</option>
                </select>
            </div>

            <div>
                <label>Situa√ß√£o de Moradia</label>
                <select id="tipoMoradia">
                    <option value="RENT">Aluguel</option>
                    <option value="OWN">Casa Pr√≥pria</option>
                    <option value="MORTGAGE">Financiado / Hipoteca</option>
                    <option value="OTHER">Outro</option>
                </select>
            </div>

            <div>
                <label>Anos Hist√≥rico Cr√©dito</label>
                <input type="number" id="anosHistorico" placeholder="Ex: 5">
            </div>

            <div class="full-width">
                <label>J√° teve nome sujo (Calote)?</label>
                <select id="jaDeuCalote">
                    <option value="N">N√£o, nunca tive</option>
                    <option value="Y">Sim, j√° tive</option>
                </select>
            </div>
        </div>

        <button onclick="enviarAnalise()">ü§ñ Analisar com IA</button>
        
        <p id="loading" class="loading">üì° Consultando C√©rebro Python via C#...</p>

        <div id="resultado"></div>
    </div>

    <script>
        async function enviarAnalise() {
            
            const dados = {
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                idade: parseInt(document.getElementById('idade').value),
                renda: parseFloat(document.getElementById('renda').value),
                valorSolicitado: parseFloat(document.getElementById('valor').value),
                parcelas: parseInt(document.getElementById('parcelas').value),
                
                
                tempoEmprego: parseFloat(document.getElementById('tempoEmprego').value),
                finalidade: document.getElementById('finalidade').value, 
                tipoMoradia: document.getElementById('tipoMoradia').value, 
                anosHistoricoCredito: parseInt(document.getElementById('anosHistorico').value),
                jaDeuCalote: document.getElementById('jaDeuCalote').value 
            };

            
            if(!dados.nome || !dados.renda || isNaN(dados.tempoEmprego)) {
                alert("Por favor, preencha todos os campos corretamente.");
                return;
            }

            const divLoading = document.getElementById('loading');
            const divResultado = document.getElementById('resultado');

            divLoading.style.display = 'block';
            divResultado.style.display = 'none';

            try {
                
                const response = await fetch('http://localhost:5295/api/analise', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Erro no servidor');
                }

                const resposta = await response.json();

                divResultado.style.display = 'block';
                divLoading.style.display = 'none';

                if (resposta.aprovado) {
                    divResultado.className = 'aprovado';
                    divResultado.innerHTML = `
                        <strong>CR√âDITO APROVADO!</strong><br>
                        <span class="score-badge">${resposta.score}</span><br>
                        Limite Sugerido: <strong>R$ ${resposta.limiteAprovado.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</strong><br>
                        <small>Nota de Risco: ${resposta.loanGrade || 'A'}</small>
                    `;
                } else {
                    divResultado.className = 'reprovado';
                    divResultado.innerHTML = `
                        <strong>CR√âDITO NEGADO</strong><br>
                        <span class="score-badge">${resposta.score}</span><br>
                        <small>${resposta.mensagem}</small><br>
                        <small>Nota de Risco: ${resposta.loanGrade || 'D'}</small>
                    `;
                }

            } catch (error) {
                console.error(error);
                alert("Erro ao conectar: " + error.message + "\n\nVerifique se o backend C# est√° rodando.");
                divLoading.style.display = 'none';
            }
        }
    </script>
</body>
</html>